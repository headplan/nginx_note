# Nginx网络事件实例演示

前面说了很多关于网络报文的发送 , 以及这些报文对应着的Nginx中的网络事件 . 比如 , 像Accept建立一条新连接 , 其实是收到了一条读事件 . 下面通过抓包分析一下 , 建立三次握手时 , 是怎样让Nginx收到读事件的 .

首先创建一个静态资源Web服务器 : [http://116.101.99.33:8080/](http://116.196.81.55:8080/) , 这个IP对应的就是Nginx服务器 . 访问这个服务器时 , 进行抓包 :

![](/assets/wireshark.png)

对Nginx服务器的IP以及8080端口进行抓包 .

```
192.168.0.101    116.101.99.33    TCP    78    56348 → 8080 [SYN] Seq=0 Win=65535 Len=0 MSS=1460 WS=32 TSval=284594423 TSecr=0 SACK_PERM=1
```

上面的IP地址是现在所在机器的IP和Nginx服务器的IP地址 . 对它建立三次握手时 , 首先发送SYN包 . 查看一下报文的TCP层 :

```
Transmission Control Protocol, Src Port: 56348, Dst Port: 8080, Seq: 0, Len: 0
```

TCP层主要做进程与进程之间通讯 . 再看IP层 : 

```
Internet Protocol Version 4, Src: 192.168.0.101, Dst: 116.101.99.33
```

主要解决机器和机器之间 , 怎么样互相找到的问题 . 

三次握手 , 就是本机先向Nginx发送一个SYN包 , 相对应的Nginx也会向本机发送一个SYN和ACK包 , 这时Nginx是没有感知到的 , 连接还是属于一个半打开的状态 , 直到本机再次发送ACK到Nginx服务器上时 , Nginx所在的操作系统 , 才会去通知Nginx收到了一个读事件 , 这个读事件对应的建立了一个新连接 , 所以Nginx此时 , 应该调用Accept方法 , 去建立一个新的连接 . 

以上 , 通过Wireshark抓包 , 演示了正常的三次握手 , 是怎样引发一个读事件 , 来使得Nginx去处理这样一个读事件 , 建立新的连接的 . 

