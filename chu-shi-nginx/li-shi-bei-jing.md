# 历史背景与优点

#### Nginx为什么会出现

![](/assets/lishibeijing.png)

#### Apache和Nginx的区别 , 或者说select模型和epoll模型的区别 .

例如 , 在菜馆中服务员接待客人 , 看成是一次请求 .

select模型服务员这样接待可以 : 客人进门 , 服务员立刻引导客人入座 , 递菜单给客人 , 等待客人点菜 . 点完菜 , 服务员到厨房下单 . 后厨做好菜后, 服务员送菜到客人的桌上 , 全程在客人桌旁招待客人 . 最后客人吃完结账 , 送客人出门 , 再继续招待下一个客人 .

epoll模型服务员 : 客人进门 , 门口的感应器告知服务员 , 服务员引导客人入座 , 菜单给客人然后去招待其他人 . 客人看了菜单 , 招呼服务员点菜 , 客人记下客人点的才 , 给后厨 , 然后继续招待其他客人 . 厨房才做好了 , 通知服务员 , 服务员上菜 , 接续做其他的 . 客人吃完饭 , 招呼服务员结账 , 然后服务员送客人出门 .

说Apache是低效的 , 因为它的架构模型里 , 一个进程同一时间 , 只会处理一个连接一个请求 . 只有在这个请求处理完成之后 , 才会去处理下一个请求 . 其潜在的意义就是在使用操作系统中的进程间切换的一个特性 , 因为操作系统微观上 , 只有优先的CPU , 但是操作系统被设计为同时服务于数百上千的进程 , 而Apache一个进程只能服务与一个连接 , 这样的模式会导致 , 当Apache需要面对几十万几百万连接的时候 , 没办法开几百万的进程 . 而且进程间切换的代价成本又太高了 , 并发数越多 , 进程间切换引发的性能消耗也就越大 .

而Nginx可以处理数百万上千万的并发连接 .

**进程解析**

正常工作的Nginx有多个进程 . 基本分为

* 主进程 - master proess
* 工作进程 - worker proess

主进程 : 充当整个进程组与用户交互的接口 , 维护并监控工作进程 . 不处理具体业务 , 只把相应的信息发送到工作进程 . 同时负责Nginx的平滑重启 , 配置文件生效 , 关闭等 .

工作进程 : 处理具体的任务 .

> Apache2.4后也使用了epoll网络I/O模型
>
> Nginx是异步处理模型 , 只需要几个进程就能够处理大量在线请求 . 而apache 2.4仍然是进程模型或者线程模型 , 即仍然采用大量线程来处理大量在线请求 . 
>
> Epoll其实只是为了实现完全事件驱动的异步方式 , 即 , Nginx可以用单线程实现数万并发连接的高吞吐量处理 . 如果是由epoll仅处理连接的建立 , 而建立好的连接交由一个线程处理 , 这种模式不是全异步的事件驱动方式 , 性能上不去的 .



